-- Il presente script serve a creare le strutture per far accedere il partner sloveno Kalliope ai dati dei ps appartenenti ai dataset di loro interesse
-- L'utenza postgres Ã¨ (username/password): RHETICUS_kalliope/kalliope

-- Role: RHETICUS_kalliope

-- DROP ROLE "RHETICUS_kalliope";

CREATE ROLE "RHETICUS_kalliope" LOGIN
  ENCRYPTED PASSWORD 'md590251bc5669cf2a3e9e5bd085c24dcf2'
  NOSUPERUSER NOINHERIT NOCREATEDB NOCREATEROLE NOREPLICATION;
COMMENT ON ROLE "RHETICUS_kalliope" IS 'Utenza del db rheticus associata al partner sloveno Kalliope';


-- Schema: kalliope

-- DROP SCHEMA kalliope;

CREATE SCHEMA kalliope
  AUTHORIZATION postgres;

GRANT ALL ON SCHEMA kalliope TO postgres;
GRANT USAGE ON SCHEMA kalliope TO "RHETICUS_kalliope";



-- View: kalliope.vw_kalliope_ps

-- DROP VIEW kalliope.vw_kalliope_ps;

CREATE OR REPLACE VIEW kalliope.vw_kalliope_ps AS 
 SELECT ps.datasetid,
    ps.psid,
    ps.lat,
    ps.lon,
    ps.sensorid,
    ps.coherence,
    ps.height,
    ps.velocity
   FROM ps
  WHERE ps.datasetid = ANY (ARRAY['Sentinel-1IWIW1-IW2-IW3124124DESCENDINGVV-VHSSLC1845.5'::text, 'Sentinel-1IWIW1-IW2-IW34444ASCENDINGVV-VHSSLC1147.5'::text]);

ALTER TABLE kalliope.vw_kalliope_ps
  OWNER TO postgres;
GRANT ALL ON TABLE kalliope.vw_kalliope_ps TO postgres;
GRANT SELECT ON TABLE kalliope.vw_kalliope_ps TO "RHETICUS_kalliope";
COMMENT ON VIEW kalliope.vw_kalliope_ps
  IS 'Vista che consente l''accesso ai PS dei dataset di interesse per il partner kalliope';
  
  -- View: kalliope.vw_kalliope_ps_measure

-- DROP VIEW kalliope.vw_kalliope_ps_measure;

CREATE OR REPLACE VIEW kalliope.vw_kalliope_ps_measure AS 
 SELECT ps_measure.datasetid,
    ps_measure.psid,
    ps_measure.type,
    ps_measure.data,
    ps_measure.measure
   FROM ps_measure
  WHERE (ps_measure.datasetid IN ( SELECT vw_kalliope_ps.datasetid
           FROM kalliope.vw_kalliope_ps));

ALTER TABLE kalliope.vw_kalliope_ps_measure
  OWNER TO postgres;
GRANT ALL ON TABLE kalliope.vw_kalliope_ps_measure TO postgres;
GRANT SELECT ON TABLE kalliope.vw_kalliope_ps_measure TO "RHETICUS_kalliope";
COMMENT ON VIEW kalliope.vw_kalliope_ps_measure
  IS 'Vista che consente l''accesso alle misure dei PS dei dataset di interesse per il partner kalliope';

